name: Build Pake EXE

on:
  push:
    branches:
      - main  # 每次 main 分支代码更新时触发

jobs:
  build:
    runs-on: windows-latest  # 使用 Windows 环境进行构建

    steps:
    - name: Checkout code
      uses: actions/checkout@v3  # 检出仓库代码

    - name: Set up Node.js
      uses: actions/setup-node@v3  # 设置 Node.js 环境
      with:
        node-version: '16'  # 设置 Node.js 版本，可以根据需要调整

    - name: Install dependencies
      run: npm install -g pake@v4  # 安装 pake@v4 版本

    - name: Prepare configuration
      run: |
        echo "{
          \"name\": \"${{ secrets.APP_NAME }}\",
          \"url\": \"${{ secrets.SITE_URL }}\",
          \"icon\": \"${{ secrets.ICON_BASE64 }}\",
          \"version\": \"1.0.0\",
          \"description\": \"${{ secrets.APP_DESCRIPTION }}\"
        }" > pake-config.json  # 将 GitHub Secrets 中的配置动态写入 JSON 配置文件

    - name: Build EXE
      run: pake build --config pake-config.json --output ./output  # 使用 pake 构建 exe 文件

    - name: Upload build artifacts
      uses: actions/upload-artifact@v3  # 上传构建好的 .exe 文件
      with:
        name: pake-exe  # 上传的文件名
        path: ./output/*.exe  # 输出的 exe 文件路径
